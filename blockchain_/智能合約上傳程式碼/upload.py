from web3 import Web3, HTTPProvider

# 連接到私有以太坊網絡
w3 = Web3(HTTPProvider('http://127.0.0.1:5002'))

# 確保與節點連接成功
assert w3.is_connected()

# 智能合約的 ABI 和 bytecode（請替換成您的合約資料）
contract_abi = [
	{
		"inputs": [],
		"name": "read",
		"outputs": [
			{
				"internalType": "string",
				"name": "",
				"type": "string"
			}
		],
		"stateMutability": "view",
		"type": "function"
	},
	{
		"inputs": [
			{
				"internalType": "string",
				"name": "_str",
				"type": "string"
			}
		],
		"name": "write",
		"outputs": [],
		"stateMutability": "nonpayable",
		"type": "function"
	}
]  # 替換成您的合約 ABI
contract_bytecode = '0x608060405234801561000f575f80fd5b506106498061001d5f395ff3fe608060405234801561000f575f80fd5b5060043610610034575f3560e01c806357de26a414610038578063ebaac77114610056575b5f80fd5b610040610072565b60405161004d919061019d565b60405180910390f35b610070600480360381019061006b91906102fa565b610101565b005b60605f80546100809061036e565b80601f01602080910402602001604051908101604052809291908181526020018280546100ac9061036e565b80156100f75780601f106100ce576101008083540402835291602001916100f7565b820191905f5260205f20905b8154815290600101906020018083116100da57829003601f168201915b5050505050905090565b805f908161010f9190610544565b5050565b5f81519050919050565b5f82825260208201905092915050565b5f5b8381101561014a57808201518184015260208101905061012f565b5f8484015250505050565b5f601f19601f8301169050919050565b5f61016f82610113565b610179818561011d565b935061018981856020860161012d565b61019281610155565b840191505092915050565b5f6020820190508181035f8301526101b58184610165565b905092915050565b5f604051905090565b5f80fd5b5f80fd5b5f80fd5b5f80fd5b7f4e487b71000000000000000000000000000000000000000000000000000000005f52604160045260245ffd5b61020c82610155565b810181811067ffffffffffffffff8211171561022b5761022a6101d6565b5b80604052505050565b5f61023d6101bd565b90506102498282610203565b919050565b5f67ffffffffffffffff821115610268576102676101d6565b5b61027182610155565b9050602081019050919050565b828183375f83830152505050565b5f61029e6102998461024e565b610234565b9050828152602081018484840111156102ba576102b96101d2565b5b6102c584828561027e565b509392505050565b5f82601f8301126102e1576102e06101ce565b5b81356102f184826020860161028c565b91505092915050565b5f6020828403121561030f5761030e6101c6565b5b5f82013567ffffffffffffffff81111561032c5761032b6101ca565b5b610338848285016102cd565b91505092915050565b7f4e487b71000000000000000000000000000000000000000000000000000000005f52602260045260245ffd5b5f600282049050600182168061038557607f821691505b60208210810361039857610397610341565b5b50919050565b5f819050815f5260205f209050919050565b5f6020601f8301049050919050565b5f82821b905092915050565b5f600883026103fa7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff826103bf565b61040486836103bf565b95508019841693508086168417925050509392505050565b5f819050919050565b5f819050919050565b5f61044861044361043e8461041c565b610425565b61041c565b9050919050565b5f819050919050565b6104618361042e565b61047561046d8261044f565b8484546103cb565b825550505050565b5f90565b61048961047d565b610494818484610458565b505050565b5b818110156104b7576104ac5f82610481565b60018101905061049a565b5050565b601f8211156104fc576104cd8161039e565b6104d6846103b0565b810160208510156104e5578190505b6104f96104f1856103b0565b830182610499565b50505b505050565b5f82821c905092915050565b5f61051c5f1984600802610501565b1980831691505092915050565b5f610534838361050d565b9150826002028217905092915050565b61054d82610113565b67ffffffffffffffff811115610566576105656101d6565b5b610570825461036e565b61057b8282856104bb565b5f60209050601f8311600181146105ac575f841561059a578287015190505b6105a48582610529565b86555061060b565b601f1984166105ba8661039e565b5f5b828110156105e1578489015182556001820191506020850194506020810190506105bc565b868310156105fe57848901516105fa601f89168261050d565b8355505b6001600288020188555050505b50505050505056fea2646970667358221220476abbe94fb8c7a57d893c594c4ad76c7930cf1672af0536da0a8324bdeaf67d64736f6c63430008170033'  # 替換成您的合約 bytecode

# 您的以太坊帳戶私鑰（請保管好您的私鑰）
private_key = '0xd386d5353714e519536651ab0bcdca8c5ebf96675563b4b37949942dfbdba8fb'

# 創建交易
account = w3.eth.account.from_key(private_key)
nonce = w3.eth.get_transaction_count(account.address)
transaction = {
    'from': account.address,
    'nonce': nonce,
    'gas': 2000000,
    'gasPrice': w3.to_wei('50', 'gwei'),
    'data': contract_bytecode,
    "chainId": 12345
}

# 簽名交易
signed_txn = w3.eth.account.sign_transaction(transaction, private_key)

# 發送交易
txn_hash = w3.eth.send_raw_transaction(signed_txn.rawTransaction)

# 獲取交易收據
receipt = w3.eth.wait_for_transaction_receipt(txn_hash)

print("合約地址:", receipt.contractAddress)
